<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>The Grammar Language</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="index.html" title="Xtext User Guide">
<link rel="prev" href="getting-started-xpand.html" title="Writing a code generator">
<link rel="next" href="syntax.html" title="The Syntax">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">The Grammar Language</h1>
<p>The 
			<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/Xtext.xtext?root=Modeling_Project&view=markup" target="_new">grammar language</a> 
			is the corner stone of Xtext. It is a domain-specific language, carefully designed for the description of textual languages.
			The main idea is to describe the concrete syntax and how it is mapped to an in-memory model created during parsing. 
		</p>
<div class="section" title="A first example">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Afirstexample"></a>A first example</h2>
</div>
</div>
</div>
<p>To get an idea of how it works we&rsquo;ll start by implementing a 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">simple example</a> 
				introduced by Martin Fowler. It&rsquo;s mainly about describing state machines used as the (un)lock mechanism of secret compartments.
				People who have secret compartments control their access in a very old-school way, e.g. by opening the door first and 
				turning on the light afterwards. Then the secret compartment, for instance a panel, opens up. One of those state machines 
				could look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">events<br>
&nbsp;&nbsp;doorClosed&nbsp;&nbsp;D1CL<br>
&nbsp;&nbsp;drawOpened&nbsp;&nbsp;D2OP<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L1ON<br>
&nbsp;&nbsp;doorOpened&nbsp;&nbsp;D1OP<br>
&nbsp;&nbsp;panelClosed&nbsp;PNCL<br>
end<br>
&nbsp;<br>
resetEvents<br>
&nbsp;&nbsp;doorOpened<br>
end<br>
&nbsp;<br>
commands<br>
&nbsp;&nbsp;unlockPanel&nbsp;PNUL<br>
&nbsp;&nbsp;lockPanel&nbsp;&nbsp;&nbsp;PNLK<br>
&nbsp;&nbsp;lockDoor&nbsp;&nbsp;&nbsp;&nbsp;D1LK<br>
&nbsp;&nbsp;unlockDoor&nbsp;&nbsp;D1UL<br>
end<br>
&nbsp;<br>
state&nbsp;idle<br>
&nbsp;&nbsp;actions&nbsp;{unlockDoor&nbsp;lockPanel}<br>
&nbsp;&nbsp;doorClosed&nbsp;=&gt;&nbsp;active<br>
end<br>
&nbsp;<br>
state&nbsp;active<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;waitingForDraw<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForLight<br>
&nbsp;&nbsp;lightOn&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;waitingForDraw<br>
&nbsp;&nbsp;drawOpened&nbsp;=&gt;&nbsp;unlockedPanel<br>
end<br>
&nbsp;<br>
state&nbsp;unlockedPanel<br>
&nbsp;&nbsp;actions&nbsp;{unlockPanel&nbsp;lockDoor}<br>
&nbsp;&nbsp;panelClosed&nbsp;=&gt;&nbsp;idle<br>
end<br>

<br>

</code>
</p>
</div>
<p>So, we have a bunch of declared events, commands, and states. Within states there are references to declared actions,
				which should be executed when entering such a state. Also there are transitions consisting of a reference to an event and 
				a state. Please read 
				<a class="ulink" href="http://martinfowler.com/dslwip/Intro.html" target="_new">Martin&rsquo;s description</a> if you want to read the whole story.
			</p>
<p>In order to implment this little language with Xtext, you need to write the following grammar:</p>
<div class="literallayout">
<p>
<code class="code">grammar&nbsp;my.pack.SecretCompartments&nbsp;<br>
&nbsp;&nbsp;&nbsp;with&nbsp;org.eclipse.xtext.common.Terminals<br>

<br>
generate&nbsp;secretcompartment&nbsp;"http://www.eclipse.org/secretcompartment"<br>
&nbsp;<br>
Statemachine&nbsp;:<br>
&nbsp;&nbsp;'events'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(events+=Event)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;('resetEvents'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(resetEvents+=[Event])+<br>
&nbsp;&nbsp;'end')?<br>
&nbsp;&nbsp;'commands'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commands+=Command)+<br>
&nbsp;&nbsp;'end'<br>
&nbsp;&nbsp;(states+=State)+;<br>
&nbsp;<br>
Event&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
Command&nbsp;:<br>
&nbsp;&nbsp;name=ID&nbsp;code=ID;<br>
&nbsp;<br>
State&nbsp;:<br>
&nbsp;&nbsp;'state'&nbsp;name=ID<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('actions'&nbsp;'{'&nbsp;(actions+=[Command])+&nbsp;'}')?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(transitions+=Transition)*<br>
&nbsp;&nbsp;'end';<br>
&nbsp;<br>
Transition&nbsp;:<br>
&nbsp;&nbsp;event=[Event]&nbsp;'=&gt;'&nbsp;state=[State];<br>
&nbsp;&nbsp;<br>

</code>
</p>
</div>
<p>Martin uses this example throughout his book &ldquo;Domain-Specific Languages&rdquo; to implement external and internal DSLs using
				different technologies. Note, that non of his implmentations is nearly as readable and concise as the description in
				Xtext&rsquo;s grammar language above. That is of course because the grammar language is designed to do just that, i.e. it is 
				specific to the domain of language descriptions.</p>
</div>
</body>
</html>
