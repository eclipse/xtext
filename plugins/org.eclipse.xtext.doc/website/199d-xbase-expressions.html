<br style="clear:both;height:1em;">
	<div id="leftcol">
		<div class="nav-logo">
			<a href="index.php"><img src="logo.png" style="margin-left:10px; width:155px"/></a>
		</div>
		<ul id="leftnav">
		<li class="partentry" >
		Getting Started
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="005-installation.php">Installation</a></div>
		<ul style="display: none;" id="subToc_005-installation.html">
		<li id="005-installation.html#InstallDistro" ><a href="005-installation.php#InstallDistro" >Install Pre-Configured Eclipse With Xtext</a></li>
		<li id="005-installation.html#InstallXtext" ><a href="005-installation.php#InstallXtext" >Install Xtext From Update Site</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="010-xtext-in-5-minutes.php">5 Minutes Tutorial</a></div>
		<ul style="display: none;" id="subToc_010-xtext-in-5-minutes.html">
		<li id="010-xtext-in-5-minutes.html#NewProject" ><a href="010-xtext-in-5-minutes.php#NewProject" >Creating A New Xtext Project</a></li>
		<li id="010-xtext-in-5-minutes.html#RunWorkflow" ><a href="010-xtext-in-5-minutes.php#RunWorkflow" >Generating The Language Infrastructure</a></li>
		<li id="010-xtext-in-5-minutes.html#TestingTheEditor" ><a href="010-xtext-in-5-minutes.php#TestingTheEditor" >Try The Editor</a></li>
		<li id="010-xtext-in-5-minutes.html#Conclusion" ><a href="010-xtext-in-5-minutes.php#Conclusion" >Conclusion</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="020-domainmodel-step-by-step.php">15 Minutes Tutorial</a></div>
		<ul style="display: none;" id="subToc_020-domainmodel-step-by-step.html">
		<li id="020-domainmodel-step-by-step.html#DomainmodelWalkThrough_4" ><a href="020-domainmodel-step-by-step.php#DomainmodelWalkThrough_4" >Create A New Xtext Project</a></li>
		<li id="020-domainmodel-step-by-step.html#DomainmodelWalkThrough_5" ><a href="020-domainmodel-step-by-step.php#DomainmodelWalkThrough_5" >Write Your Own Grammar</a></li>
		<li id="020-domainmodel-step-by-step.html#DomainmodelWalkThrough_6" ><a href="020-domainmodel-step-by-step.php#DomainmodelWalkThrough_6" >Generate Language Artifacts</a></li>
		<li id="020-domainmodel-step-by-step.html#DomainmodelWalkThrough_7" ><a href="020-domainmodel-step-by-step.php#DomainmodelWalkThrough_7" >Run the Generated IDE Plug-in</a></li>
		<li id="020-domainmodel-step-by-step.html#DomainmodelWalkThrough_8" ><a href="020-domainmodel-step-by-step.php#DomainmodelWalkThrough_8" >Second Iteration : Adding Packages and Imports</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="030-tutorial-next-steps.php">15 Minutes Tutorial - Extended</a></div>
		<ul style="display: none;" id="subToc_030-tutorial-next-steps.html">
		<li id="040-first-code-generator.html" ><a href="040-first-code-generator.php" >Writing a Code Generator With Xtend</a></li>
		<li id="060-unit-tests.html" ><a href="060-unit-tests.php" >Unit Testing the Language</a></li>
		<li id="050-validation.html" ><a href="050-validation.php" >Creating Custom Validation Rules</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="035-domainmodel-java.php">Five simple steps to your JVM language</a></div>
		<ul style="display: none;" id="subToc_035-domainmodel-java.html">
		<li id="035-domainmodel-java.html#JvmDomainmodel_7" ><a href="035-domainmodel-java.php#JvmDomainmodel_7" >Step One: Create A New Xtext Project</a></li>
		<li id="035-domainmodel-java.html#JvmDomainmodel_8" ><a href="035-domainmodel-java.php#JvmDomainmodel_8" >Step Two: Write the Grammar</a></li>
		<li id="035-domainmodel-java.html#JvmDomainmodel_9" ><a href="035-domainmodel-java.php#JvmDomainmodel_9" >Step Three: Generate Language Artifacts</a></li>
		<li id="035-domainmodel-java.html#JvmDomainmodel_10" ><a href="035-domainmodel-java.php#JvmDomainmodel_10" >Step Four: Define the Mapping to JVM Concepts</a></li>
		<li id="035-domainmodel-java.html#JvmDomainmodel_11" ><a href="035-domainmodel-java.php#JvmDomainmodel_11" >Step Five : Try the Editor!</a></li>
		</ul>
		</li>
		<li class="partentry" >
		Reference Documentation
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="000-introduction.php">Overview</a></div>
		<ul style="display: none;" id="subToc_000-introduction.html">
		<li id="000-introduction.html#Overview_1" ><a href="000-introduction.php#Overview_1" >What is Xtext?</a></li>
		<li id="000-introduction.html#Overview_2" ><a href="000-introduction.php#Overview_2" >How Does It Work?</a></li>
		<li id="000-introduction.html#Overview_3" ><a href="000-introduction.php#Overview_3" >Xtext is Highly Configurable</a></li>
		<li id="000-introduction.html#Overview_4" ><a href="000-introduction.php#Overview_4" >Who Uses Xtext?</a></li>
		<li id="000-introduction.html#Overview_5" ><a href="000-introduction.php#Overview_5" >Who is Behind Xtext?</a></li>
		<li id="000-introduction.html#DSL" ><a href="000-introduction.php#DSL" >What is a Domain-Specific Language</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="020-grammar-language.php">The Grammar Language</a></div>
		<ul style="display: none;" id="subToc_020-grammar-language.html">
		<li id="020-grammar-language.html#statemachine" ><a href="020-grammar-language.php#statemachine" >A First Example</a></li>
		<li id="020-grammar-language.html#syntax" ><a href="020-grammar-language.php#syntax" >The Syntax</a></li>
		<li id="020-grammar-language.html#metamodelInference" ><a href="020-grammar-language.php#metamodelInference" >Ecore Model Inference</a></li>
		<li id="020-grammar-language.html#grammarMixins" ><a href="020-grammar-language.php#grammarMixins" >Grammar Mixins</a></li>
		<li id="020-grammar-language.html#grammarLanguage_6" ><a href="020-grammar-language.php#grammarLanguage_6" >Common Terminals</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="030-generator.php">Configuration</a></div>
		<ul style="display: none;" id="subToc_030-generator.html">
		<li id="030-generator.html#generator" ><a href="030-generator.php#generator" >The Language Generator</a></li>
		<li id="040-dependency-injection.html" ><a href="040-dependency-injection.php" >Dependency Injection in Xtext with Google Guice</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="050-heading-runtime.php">Runtime Concepts</a></div>
		<ul style="display: none;" id="subToc_050-heading-runtime.html">
		<li id="050-heading-runtime.html#runtimeSetup" ><a href="050-heading-runtime.php#runtimeSetup" >Runtime Setup (ISetup)</a></li>
		<li id="050-heading-runtime.html#equinoxSetup" ><a href="050-heading-runtime.php#equinoxSetup" >Setup within Eclipse-Equinox (OSGi)</a></li>
		<li id="050-heading-runtime.html#runtime_concepts_4" ><a href="050-heading-runtime.php#runtime_concepts_4" >Logging</a></li>
		<li id="060-validation.html" ><a href="060-validation.php" >Validation</a></li>
		<li id="070-linking.html" ><a href="070-linking.php" >Linking</a></li>
		<li id="080-scoping.html" ><a href="080-scoping.php" >Scoping</a></li>
		<li id="090-valueconverter.html" ><a href="090-valueconverter.php" >Value Converter</a></li>
		<li id="100-serialization.html" ><a href="100-serialization.php" >Serialization</a></li>
		<li id="105-formatting.html" ><a href="105-formatting.php" >Formatting (Pretty Printing)</a></li>
		<li id="110-fragmentprovider.html" ><a href="110-fragmentprovider.php" >Fragment Provider (Referencing Xtext Models From Other EMF Artifacts)</a></li>
		<li id="115-encoding.html" ><a href="115-encoding.php" >Encoding in Xtext</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="120-heading-UI.php">IDE Concepts</a></div>
		<ul style="display: none;" id="subToc_120-heading-UI.html">
		<li id="140-labelprovider.html" ><a href="140-labelprovider.php" >Label Provider</a></li>
		<li id="150-contentassist.html" ><a href="150-contentassist.php" >Content Assist</a></li>
		<li id="155-quickfix.html" ><a href="155-quickfix.php" >Quick Fixes</a></li>
		<li id="160-templates.html" ><a href="160-templates.php" >Template Proposals</a></li>
		<li id="170-outline.html" ><a href="170-outline.php" >Outline View</a></li>
		<li id="180-hyperlinking.html" ><a href="180-hyperlinking.php" >Hyperlinking</a></li>
		<li id="195-highlighting.html" ><a href="195-highlighting.php" >Syntax Coloring</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="199-xtext-and-java.php">Xtext and Java</a></div>
		<ul style="display: none;" id="subToc_199-xtext-and-java.html">
		<li id="199-xtext-and-java.html#Xbase_3" ><a href="199-xtext-and-java.php#Xbase_3" >Plug-in Setup</a></li>
		<li id="199a-jvmtypes.html" ><a href="199a-jvmtypes.php" >Referring to Java Elements using JVM Types</a></li>
		<li id="199b-xbase-java-references.html" ><a href="199b-xbase-java-references.php" >Referring to Java Types Using Xbase</a></li>
		<li id="199c-xbase-inferred-type.html" ><a href="199c-xbase-inferred-type.php" >Inferring a JVM Model</a></li>
		<li id="199d-xbase-expressions.html" ><a href="199d-xbase-expressions.php" >Using Xbase Expressions</a></li>
		<li id="199e-xbase-language-reference.html" ><a href="199e-xbase-language-reference.php" >Xbase Language Reference</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="118-mwe-in-depth.php">MWE2</a></div>
		<ul style="display: none;" id="subToc_118-mwe-in-depth.html">
		<li id="118-mwe-in-depth.html#MWE2Exampe" ><a href="118-mwe-in-depth.php#MWE2Exampe" >Examples</a></li>
		<li id="118-mwe-in-depth.html#MWE2LanguageReference" ><a href="118-mwe-in-depth.php#MWE2LanguageReference" >Language Reference</a></li>
		<li id="118-mwe-in-depth.html#MWE2SyntaxReference" ><a href="118-mwe-in-depth.php#MWE2SyntaxReference" >Syntax Reference</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="01-Xtend_Introduction.php">Xtend</a></div>
		<ul style="display: none;" id="subToc_01-Xtend_Introduction.html">
		<li id="01-Xtend_Introduction.html#Getting_Started" ><a href="01-Xtend_Introduction.php#Getting_Started" >Getting Started</a></li>
		<li id="02-Xtend_Classes_Functions.html" ><a href="02-Xtend_Classes_Functions.php" >Classes and Functions</a></li>
		<li id="03-Xtend_Expressions.html" ><a href="03-Xtend_Expressions.php" >Expressions</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="210-emf-integration.php">Integration with EMF and Other EMF Editors</a></div>
		<ul style="display: none;" id="subToc_210-emf-integration.html">
		<li id="210-emf-integration.html#model_metamodel" ><a href="210-emf-integration.php#model_metamodel" >Model, Ecore Model, and Ecore</a></li>
		<li id="210-emf-integration.html#emf_codegen" ><a href="210-emf-integration.php#emf_codegen" >EMF Code Generation</a></li>
		<li id="210-emf-integration.html#xtext_resource" ><a href="210-emf-integration.php#xtext_resource" >XtextResource Implementation</a></li>
		<li id="210-emf-integration.html#gmf_integration" ><a href="210-emf-integration.php#gmf_integration" >Integration with GMF Editors</a></li>
		</ul>
		</li>
		<li class="partentry" >
		Appendix
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="213-migrating-from-1.0.php">Migrating from Xtext 1.0.x to 2.0</a></div>
		<ul style="display: none;" id="subToc_213-migrating-from-1.0.html">
		<li id="213-migrating-from-1.0.html#migrating_from_1_0_x_4" ><a href="213-migrating-from-1.0.php#migrating_from_1_0_x_4" >Take the Shortcut</a></li>
		<li id="213-migrating-from-1.0.html#migrating_from_1_0_x_5" ><a href="213-migrating-from-1.0.php#migrating_from_1_0_x_5" >Migrating Step By Step</a></li>
		<li id="213-migrating-from-1.0.html#migrating_from_1_0_x_6" ><a href="213-migrating-from-1.0.php#migrating_from_1_0_x_6" >Now go for then new features</a></li>
		</ul>
		</li>
		<li class="separator"><div class="separator">
		<img src="triangle.gif" style="height:12px; margin-right: 2px; "  /><img src="triangle-90.gif" style="display:none; margin-right: 2px" height="12px" />
		<a href="215-migrating-from-0.7.php">Migrating from Xtext 0.7.x to 1.0</a></div>
		<ul style="display: none;" id="subToc_215-migrating-from-0.7.html">
		<li id="215-migrating-from-0.7.html#migrating_from_0_7_2" ><a href="215-migrating-from-0.7.php#migrating_from_0_7_2" >Migrating Step By Step</a></li>
		</ul>
		</li>
		</ul>
	</div>
	<div id="midcolumn">
		<a name="xbaseExpressions" ></a>
		<span style="float:left; border-top: 1px dotted #d4d4dd; margin-left: 0; margin-top: 5px;
			padding: 5px 0;
			padding-top: 5px;"></span><a style="float: right" href="#">Top</a>
			<br style="clear:both"></br>
			<h1>Using Xbase Expressions</h1>
			<div class="toc">
			  <ul>
			    <li><a href="199d-xbase-expressions.php#xbaseExpressions_2" >Making Your Grammar Refer To Xbase</a></li>
			    <li><a href="199d-xbase-expressions.php#xbaseScopeProvider" >Populating the Scopes</a></li>
			    <li><a href="199d-xbase-expressions.php#xbaseExpressions_4" >Type Checking at the Boundaries</a></li>
			    <li><a href="199d-xbase-expressions.php#xbaseExpressions_5" >Generating Java Code using the Xbase Compiler</a></li>
			    <li><a href="199d-xbase-expressions.php#xbaseExpressions_6" >Using the Xbase Interpreter</a></li>
			  </ul>
			</div>
			<p>
			Xbase is an expression language that can be embedded in Xtext languages. Its syntax is close to Java,
			but it additionally offers type inferrence, closures, a rich switch statement and a lot more. For details
			on the Xbase langugae itself, please consult the Xbase documentation and the Xbase tutorial. Xbase ships 
			with an interpreter and a compiler to Java code. Thus, it is easy to add executable behavior to your DSLs.
			As Xbase integrates tightly with Java, there is usually no additional code needed to run your DSL as
			part of a Java application. 
			</p>
			<a name="xbaseExpressions_2" ></a>
			<h2>Making Your Grammar Refer To Xbase</h2>
			<p>
			If you want to refer to <a class="jdoc" href="http://download.eclipse.org/modeling/emf/emf/javadoc/2.6.0/org/eclipse/emf/ecore/EClassifier.html" title="org.eclipse.emf.ecore.EClassifier">EClassifiers</abbr></a> from the Xbase model, you need
			to import it first. The same holds for the common types model:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">import</span>&nbsp;<span class="string">"http://www.eclipse.org/xtext/xbase/Xbase"</span>&nbsp;<span class="keyword">as</span>&nbsp;xbase
					</p>
				</div>
			</div>
			</p>
			<p>
			Now identify the location in your grammar, where you want references to Java types and Xbase expression to appear
			and call the appropriate rules of the super grammar. <div class="todo" >
			</div>
			 Have a look at the domainmodel example: An <em>Operation</em>'s 
			parameters are <em>JvmFormalParamters</em>, its return type refers to a Java type and its <em>body</em> is
			an <em>XBlockExpression</em>, so its parser rule reads as
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						Operation:<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;visibility=Visibility?&nbsp;<span class="string">&apos;op&apos;</span>&nbsp;name=ValidID&nbsp;<span class="string">&apos;(&apos;</span>&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;(params+=JvmFormalParameter&nbsp;(<span class="string">&apos;,&apos;</span>&nbsp;params+=JvmFormalParameter)*)?&nbsp;<span class="string">&apos;)&apos;</span>&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">&apos;:&apos;</span>&nbsp;type=JvmTypeReference&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body=XBlockExpression;
					</p>
				</div>
			</div>
			</p>
			<p>
			If you're unsure which entry point to choose for your expressions, consider the root <em>XExpression</em>.
			</p>
			<p>
			To integrate <em>Operations</em>&nbsp;in our models, we have to call this rule. We copy the previous <em>Feature</em>
			to a new rule <em>Property</em> and let <em>Feature</em> become the supertype of <em>Property</em> and <em>Operation</em>:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						Feature:<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;Property&nbsp;|&nbsp;Operation<br/>
						;<br/>
						&nbsp;<br/>
						Property:<br/>
						&nbsp;&nbsp;name&nbsp;=&nbsp;ID&nbsp;<span class="string">&apos;:&apos;</span>&nbsp;type&nbsp;=&nbsp;JvmTypeReference<br/>
						;
					</p>
				</div>
			</div>
			</p>
			<p>
			Note: You will have to adapt the <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/jvmmodel/IJvmModelInferrer.html" title="org.eclipse.xtext.xbase.jvmmodel.IJvmModelInferrer">IJvmModelInferrer</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/jvmmodel/IJvmModelInferrer.java" title="View Source Code" >(src)</a> to these
			changes, i.e. rename <em>Feature</em> to <em>Property</em> and create a <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/common/types/JvmOperation.html" title="org.eclipse.xtext.common.types.JvmOperation">JvmOperation</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext/src/org/eclipse/xtext/common/types/JvmOperation.java" title="View Source Code" >(src)</a>
			for each <em>Operation</em>. We leave that as an exercise :-) 
			</p>
			<a name="xbaseScopeProvider" ></a>
			<h2>Populating the Scopes</h2>
			<p>
			If you're not familiar with Xtext's concept of scopes yet, it would be a good idea to <a href="080-scoping.php" title="Go to &quot;Scoping&quot;">learn about
			scopes</a> before you go on reading this section. 
			</p>
			<p>
			The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/scoping/XbaseScopeProvider.html" title="org.eclipse.xtext.xbase.scoping.XbaseScopeProvider">XbaseScopeProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/scoping/XbaseScopeProvider.java" title="View Source Code" >(src)</a> already builds a complex hierarchy of
			scopes that is necessary to link your expressions. There are a few points you may want to customize.
			</p>
			<p>
			Within the body of an operation, we want to have several variables on the scope. The variable <em>this</em>
			should point to the JVM type of the entity, such that all its features are callable. In addition, the
			operation's parameters should be referrable by their name. The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/scoping/XbaseScopeProvider.html" title="org.eclipse.xtext.xbase.scoping.XbaseScopeProvider">XbaseScopeProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/scoping/XbaseScopeProvider.java" title="View Source Code" >(src)</a>
			has a template method <em>createLocalVarScope</em> for exactly this purpose. The following code shows the Xtend
			implementation of the scope provider for our domain model language:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">class</span>&nbsp;DomainmodelScopeProvider&nbsp;<span class="keyword">extends</span>&nbsp;XbaseScopeProvider&nbsp;{<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Inject&nbsp;<span class="keyword">extension</span>&nbsp;IJvmModelAssociations&nbsp;associations<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">override</span>&nbsp;IScope&nbsp;createLocalVarScope(EObject&nbsp;context,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EReference&nbsp;reference,&nbsp;IScope&nbsp;parent,<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">boolean</span>&nbsp;includeCurrentBlock,&nbsp;<span class="keyword">int</span>&nbsp;idx)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(context&nbsp;<span class="keyword">instanceof</span>&nbsp;Entity)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;type&nbsp;=&nbsp;(context&nbsp;<span class="keyword">as</span>&nbsp;Entity).jvmType<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">new</span>&nbsp;SimpleScope(parent,&nbsp;newImmutableList(<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EObjectDescription::<span class="keyword">create</span>(XbaseScopeProvider::THIS,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type)))<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(context&nbsp;<span class="keyword">instanceof</span>&nbsp;Operation){<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;descriptions&nbsp;=&nbsp;(context&nbsp;<span class="keyword">as</span>&nbsp;Operation)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.params.map(e&nbsp;|&nbsp;e.createIEObjectDescription())<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;MapBasedScope::createScope(<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">super</span>.createLocalVarScope(context,&nbsp;reference,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent,&nbsp;includeCurrentBlock,&nbsp;idx),&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;descriptions);&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">super</span>.createLocalVarScope(context,&nbsp;reference,&nbsp;parent,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;includeCurrentBlock,&nbsp;idx)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;createIEObjectDescription(JvmFormalParameter&nbsp;jvmFormalParameter)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EObjectDescription::^create(<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QualifiedName::^create(jvmFormalParameter.name),&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jvmFormalParameter,&nbsp;null);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;JvmType&nbsp;getJvmType(Entity&nbsp;entity)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.jvmElements.filter(<span class="keyword">typeof</span>(JvmType)).head<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">override</span>&nbsp;JvmDeclaredType&nbsp;getContextType(EObject&nbsp;call)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(call&nbsp;==&nbsp;null)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;null<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">val</span>&nbsp;containerClass&nbsp;=&nbsp;getContainerOfType(call,&nbsp;<span class="keyword">typeof</span>(Entity));<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(containerClass&nbsp;!=&nbsp;null)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;getJvmType(containerClass)&nbsp;<span class="keyword">as</span>&nbsp;JvmDeclaredType<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">super</span>.getContextType(call)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<p>
			In addition to the variable binding and some helper functions, we defined the function <em>getContextType</em>
			to tell Xbase, which features are visible (callable) in the context of a the given element. In out case,
			these are all features of the inferred type, including the private ones.    
			</p>
			<a name="xbaseExpressions_4" ></a>
			<h2>Type Checking at the Boundaries</h2>
			<p>
			The scope provider from the last section allows Xbase to do static type analysis on the operation bodies,
			as all callable properties now have types.  The missing part is to make sure that the declared return type 
			conforms to the actual types of the method body's possible return values.
			</p>
			<p>
			Type analysis in Xbase boils down to compare expected types with the actual types returned by an expression. 
			For example, the condition of an <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/XIfExpression.html" title="org.eclipse.xtext.xbase.XIfExpression">XIfExpression</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/XIfExpression.java" title="View Source Code" >(src)</a>
			is expected to be a boolean, so any expression used as condition should conform to the boolean type.
			The component the defines these types and expectations is the <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/typing/ITypeProvider.html" title="org.eclipse.xtext.xbase.typing.ITypeProvider">ITypeProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/typing/ITypeProvider.java" title="View Source Code" >(src)</a>. 
			It has several responsibilities
			</p>
			<p>
			<table>
			  <tr>
			    <td>getType()</td>
			    <td>returns the type of an expression</td>
			  </tr>
			  <tr>
			    <td>getExpectedType()</td>
			    <td>returns the expected type of an expression in a given context</td>
			  </tr>
			  <tr>
			    <td>getTypeForIdentifiable()</td>
			    <td>returns the expected type of an element that is referenced</td>
			  </tr>
			  <tr>
			    <td>getCommonReturnType()</td>
			    <td>returns the common supertype of all types used in return expressions
			    	inside this expression</td>
			  </tr>
			  <tr>
			    <td>getThrownExceptions()</td>
			    <td>returns the types of all declared exceptions thrown inside this expression</td>
			  </tr>
			</table>
			</p>
			<p>
			An additional flag <em>rawType</em> signals a raw type without resolved type parameters is enough. This is
			needed to avoid cycles in the type inference while linking.
			 
			The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/typing/XbaseTypeProvider.html" title="org.eclipse.xtext.xbase.typing.XbaseTypeProvider">XbaseTypeProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/typing/XbaseTypeProvider.java" title="View Source Code" >(src)</a> implements polymorphic dispatch methods
			for the first three of these. In the domain model example, we expect the return type of the body of an <em>Operation</em>
			to conform to the declared return type. We can do so by specializing the default 
			<a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/typing/XbaseTypeProvider.html" title="org.eclipse.xtext.xbase.typing.XbaseTypeProvider">XbaseTypeProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/typing/XbaseTypeProvider.java" title="View Source Code" >(src)</a> as
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						@Singleton<br/>
						<span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;DomainmodelTypeProvider&nbsp;<span class="keyword">extends</span>&nbsp;XbaseTypeProvider&nbsp;{<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span>&nbsp;JvmTypeReference&nbsp;_expectedType(Operation&nbsp;operation,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EReference&nbsp;reference,&nbsp;<span class="keyword">int</span>&nbsp;index,&nbsp;<span class="keyword">boolean</span>&nbsp;rawType)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(reference&nbsp;==&nbsp;DomainmodelPackage.Literals.OPERATION__BODY)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;operation.getType();<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">null</span>;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<p>
			and of course binding this new implementation in the languge's module. By default, Xbase only checks
			type conformance inside expressions. To address the validation at the expression's boundary, we have
			to add a <a href="060-validation.php" title="Go to &quot;Validation&quot;">validation rule</a>:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;DomainmodelJavaValidator&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">extends</span>&nbsp;AbstractDomainmodelJavaValidator&nbsp;{<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Inject<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;XbaseTypeConformanceComputer&nbsp;typeConformanceComputer;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Inject<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;DomainmodelTypeProvider&nbsp;typeProvider;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Check<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;checkTypeConformanceOfOperation(Operation&nbsp;op){<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JvmTypeReference&nbsp;expectedType&nbsp;=&nbsp;typeProvider<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getExpectedType(op.getBody());<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JvmTypeReference&nbsp;commonReturnType&nbsp;=&nbsp;typeProvider<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getCommonReturnType(op.getBody(),&nbsp;<span class="keyword">true</span>);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!typeConformanceComputer.isConformant(expectedType,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commonReturnType))<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(<span class="string">"Type&nbsp;does&nbsp;not&nbsp;conform&nbsp;to&nbsp;expected&nbsp;type!"</span>,<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.Literals.OPERATION__BODY);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<a name="xbaseExpressions_5" ></a>
			<h2>Generating Java Code using the Xbase Compiler</h2>
			<p>
			The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/compiler/XbaseCompiler.html" title="org.eclipse.xtext.xbase.compiler.XbaseCompiler">XbaseCompiler</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/compiler/XbaseCompiler.java" title="View Source Code" >(src)</a> compiles Xbase expressions to Java code.
			You will now learn how to integrate it in the code generator of your DSL. 
			</p>
			<p>
			The following snippet shows how the code generator can call the compiler:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">class</span>&nbsp;DomainmodelGenerator&nbsp;<span class="keyword">implements</span>&nbsp;IGenerator&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Inject&nbsp;DomainmodelCompiler&nbsp;domainmodelCompiler<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;<span class="keyword">dispatch</span>&nbsp;compile(Operation&nbsp;o,&nbsp;ImportManager&nbsp;importManager)&nbsp;<span class="string">&apos;&apos;</span><span class="string">&apos;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;&laquo;o.type.shortName(importManager)&raquo;&nbsp;&laquo;o.name&raquo;(&laquo;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.parameterList(importManager)&raquo;)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&laquo;domainmodelCompiler.compile(o,&nbsp;importManager)&raquo;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&apos;</span><span class="string">&apos;&apos;</span><br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;parameterList(Operation&nbsp;o,&nbsp;ImportManager&nbsp;importManager)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o.params.map(p|&nbsp;p.parameterType.shortName(importManager)&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span class="string">&apos;&nbsp;&apos;</span>&nbsp;+&nbsp;p.name).join(<span class="string">&apos;&apos;</span><span class="string">&apos;,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&apos;</span><span class="string">&apos;&apos;</span><br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<p>
			Now let us customize the compiler. The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/compiler/XbaseCompiler.html" title="org.eclipse.xtext.xbase.compiler.XbaseCompiler">XbaseCompiler</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/compiler/XbaseCompiler.java" title="View Source Code" >(src)</a> writes its code output into an 
			<a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/compiler/IAppendable.html" title="org.eclipse.xtext.xbase.compiler.IAppendable">IAppendable</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/compiler/IAppendable.java" title="View Source Code" >(src)</a>. This component keeps track of the indentation, 
			of local variables, and of the generated code. Use an <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/compiler/StringBuilderBasedAppendable.html" title="org.eclipse.xtext.xbase.compiler.StringBuilderBasedAppendable">StringBuilderBasedAppendable</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/compiler/StringBuilderBasedAppendable.java" title="View Source Code" >(src)</a>
			to generate the code of an XbaseExpression into a <a class="jdoc" href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/StringBuilder.html" title="java.lang.StringBuilder">StringBuilder</abbr></a>. Before calling the
			compiler, we add the operation's parameters to the local variables. 
			</p>
			<p>
			Remember that in the <a href="199d-xbase-expressions.php#xbaseScopeProvider" title="Go to &quot;Populating the Scopes&quot;">scope provider</a> we bound the variable <em>this</em> to the inferred type of the current <em>Entity</em>. 
			The <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/compiler/XbaseCompiler.html" title="org.eclipse.xtext.xbase.compiler.XbaseCompiler">XbaseCompiler</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/compiler/XbaseCompiler.java" title="View Source Code" >(src)</a> will by default assign the value of all expressions
			to a new Java variable. If we just call <em>this</em>, we don't need that, so we override <em>isVariableDeclarationRequired</em>
			to return false in this case. Similarly, whenever the compiler needs to put a variable name for the inferred
			Java type, it should use <em>this</em>. This can be achieved by overriding <em>getVarName()</em>. In a similar way,
			we have to override the <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/featurecalls/IdentifiableSimpleNameProvider.html" title="org.eclipse.xtext.xbase.featurecalls.IdentifiableSimpleNameProvider">IdentifiableSimpleNameProvider</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/featurecalls/IdentifiableSimpleNameProvider.java" title="View Source Code" >(src)</a>
			to return <em>this</em> for the type. It is likely that we will reduce the last two tasks to one in the future.
			</p>
			<p>
			Here's the complete code for the customized compiler:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;DomainmodelCompiler&nbsp;<span class="keyword">extends</span>&nbsp;XbaseCompiler&nbsp;{<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;String&nbsp;compile(Operation&nbsp;operation,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImportManager&nbsp;importManager)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilderBasedAppendable&nbsp;appendable&nbsp;=&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">new</span>&nbsp;StringBuilderBasedAppendable(importManager);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>(JvmFormalParameter&nbsp;param:&nbsp;operation.getParams())&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appendable.declareVariable(param,&nbsp;param.getName());<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;compile(operation.getBody(),&nbsp;appendable,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation.getType()).toString();<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span>&nbsp;<span class="keyword">boolean</span>&nbsp;isVariableDeclarationRequired(XExpression&nbsp;expr,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IAppendable&nbsp;b)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(expr&nbsp;<span class="keyword">instanceof</span>&nbsp;XAbstractFeatureCall&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;((XAbstractFeatureCall)expr).getFeature()&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">instanceof</span>&nbsp;JvmGenericType)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">super</span>.isVariableDeclarationRequired(expr,b);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">protected</span>&nbsp;String&nbsp;getVarName(Object&nbsp;ex,&nbsp;IAppendable&nbsp;appendable)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(ex&nbsp;<span class="keyword">instanceof</span>&nbsp;JvmGenericType)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"this"</span>;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">super</span>.getVarName(ex,&nbsp;appendable);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">class</span>&nbsp;DomainmodelIdentifiableSimpleNameProvider&nbsp;<span class="keyword">extends</span>&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;IdentifiableSimpleNameProvider&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;<span class="keyword">dispatch</span>&nbsp;getSimpleName(JvmType&nbsp;element)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"this"</span>;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span>&nbsp;<span class="keyword">dispatch</span>&nbsp;getSimpleName(JvmIdentifiableElement&nbsp;element)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">super</span>.getSimpleName(element);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
						}
					</p>
				</div>
			</div>
			</p>
			<a name="xbaseExpressions_6" ></a>
			<h2>Using the Xbase Interpreter</h2>
			<p>
			Sometimes it is more convenient to interpret a model that uses Xbase than to generate code from it.  
			Xbase ships with the <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.html" title="org.eclipse.xtext.xbase.interpreter.impl.XbaseInterpreter">XbaseInterpreter</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.java" title="View Source Code" >(src)</a> which makes this
			rather easy.
			</p>
			<p>
			An interpreter is essentially an external visitor, that recursively processes a model based on the model
			element's types. By now you should be aware that polymorphic dispatch is exactly the technology needed
			here. In the <a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.html" title="org.eclipse.xtext.xbase.interpreter.impl.XbaseInterpreter">XbaseInterpreter</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.java" title="View Source Code" >(src)</a>, the dispatch method
			is called <em>_evaluate&lt;ElementTypeWithoutX&gt;</em> and takes two parameters, e.g. 
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						<span class="keyword">protected</span>&nbsp;Object&nbsp;_evaluateBlockExpression(XBlockExpression&nbsp;literal,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IEvaluationContext&nbsp;context,&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CancelIndicator&nbsp;indicator)
					</p>
				</div>
			</div>
			</p>
			<p>
			The <a class="jdoc" href="http://help.eclipse.org/helios/topic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/core/expressions/IEvaluationContext.html" title="org.eclipse.core.expressions.IEvaluationContext">IEvaluationContext</abbr></a> keeps the state of the running application,
			i.e. the local variables and their values. Additionally, it can be <em>fork</em>ed, thus allowing to shadow the 
			elements of the original context. Here is an example code snippet how to call the
			<a class="jdoc" href="http://download.eclipse.org/modeling/tmf/xtext/javadoc/2.0.0/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.html" title="org.eclipse.xtext.xbase.interpreter.impl.XbaseInterpreter">XbaseInterpreter</abbr></a> <a class="srcLink" href="https://github.com/svenefftinge/Xtext-2.0-released-source-code/tree/master/plugins/org.eclipse.xtext.xbase/src/org/eclipse/xtext/xbase/interpreter/impl/XbaseInterpreter.java" title="View Source Code" >(src)</a>:
			</p>
			<p>
			<div class="literallayout">
				<div class="incode">
					<p class="code">
						@Inject&nbsp;<span class="keyword">private</span>&nbsp;XbaseInterpreter&nbsp;xbaseInterpreter;<br/>
						<br/>
						@Inject&nbsp;<span class="keyword">private</span>&nbsp;Provider&lt;IEvaluationContext&gt;&nbsp;contextProvider;<br/>
						<br/>
						...<br/>
						<span class="keyword">public</span>&nbsp;Object&nbsp;evaluate(XExpression&nbsp;expression,&nbsp;Object&nbsp;thisElement)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;IEvaluationContext&nbsp;evaluationContext&nbsp;=&nbsp;contextProvider.get();<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;evaluationContext.newValue(XbaseScopeProvider.THIS,&nbsp;thisElement);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;IEvaluationResult&nbsp;result&nbsp;=&nbsp;xbaseInterpreter.evaluate(expression,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluationContext,&nbsp;CancelIndicator.NullImpl);<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(result.getException()&nbsp;!=&nbsp;<span class="keyword">null</span>)&nbsp;{<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;handle&nbsp;exception<br/>
						</span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br/>
						&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;result.getResult();<br/>
						}
					</p>
				</div>
			</div>
			</p>
		<div id="disqus_thread"></div>
		<script type="text/javascript" src="documentationRoot.js"></script>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		    var disqus_shortname = 'xtext'; // required: replace example with your forum shortname
		
		    // The following are highly recommended additional parameters. Remove the slashes in front to use.
		    var disqus_identifier = 'xbaseExpressions';
		    var disqus_url = documentationRoot+'199d-xbase-expressions.php';
		
		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
 		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	</div>
	<br style="clear:both;height:1em;">
